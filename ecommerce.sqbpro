<?xml version="1.0" encoding="UTF-8"?><sqlb_project><db path="ecommerce.db" readonly="0" foreign_keys="1" case_sensitive_like="0" temp_store="0" wal_autocheckpoint="1000" synchronous="2"/><attached/><window><main_tabs open="structure browser pragmas query" current="3"/></window><tab_structure><column_width id="0" width="300"/><column_width id="1" width="0"/><column_width id="2" width="100"/><column_width id="3" width="2774"/><column_width id="4" width="0"/><expanded_item id="0" parent="1"/><expanded_item id="1" parent="1"/><expanded_item id="2" parent="1"/><expanded_item id="3" parent="1"/></tab_structure><tab_browse><table title="Amazon Sale Report" custom_title="0" dock_id="7" table="4,18:mainAmazon Sale Report"/><dock_state state="000000ff00000000fd00000001000000020000033b0000021efc0100000006fb000000160064006f0063006b00420072006f00770073006500310100000000ffffffff0000000000000000fb000000160064006f0063006b00420072006f00770073006500320100000000ffffffff0000000000000000fc000000000000033b0000000000fffffffa000000000100000002fb000000160064006f0063006b00420072006f00770073006500330100000000ffffffff0000000000000000fb000000160064006f0063006b00420072006f00770073006500340100000000ffffffff0000000000000000fb000000160064006f0063006b00420072006f007700730065003501000000000000033b0000000000000000fb000000160064006f0063006b00420072006f00770073006500360100000000ffffffff0000000000000000fb000000160064006f0063006b00420072006f007700730065003701000000000000033b0000014b00ffffff000002580000000000000004000000040000000800000008fc00000000"/><default_encoding codec=""/><browse_table_settings><table schema="main" name="Amazon Sale Report" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="39"/><column index="2" value="156"/><column index="3" value="70"/><column index="4" value="226"/><column index="5" value="70"/><column index="6" value="86"/><column index="7" value="106"/><column index="8" value="70"/><column index="9" value="202"/><column index="10" value="109"/><column index="11" value="39"/><column index="12" value="85"/><column index="13" value="88"/><column index="14" value="29"/><column index="15" value="57"/><column index="16" value="62"/><column index="17" value="300"/><column index="18" value="140"/><column index="19" value="101"/><column index="20" value="78"/><column index="21" value="300"/><column index="22" value="46"/><column index="23" value="78"/><column index="24" value="82"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table></browse_table_settings></tab_browse><tab_sql><sql name="SQL 1">SELECT &quot;Order ID&quot;, &quot;Date&quot;, &quot;SKU&quot;, &quot;Category&quot;, &quot;Qty&quot;, CAST(&quot;Amount&quot; AS REAL) AS amount, &quot;Status&quot;
FROM &quot;Amazon Sale Report&quot;
WHERE TRIM(COALESCE(&quot;Amount&quot;,'') ) &lt;&gt; ''
ORDER BY amount DESC
LIMIT 20;


SELECT &quot;Order ID&quot;, &quot;Date&quot;, &quot;SKU&quot;, &quot;Category&quot;, CAST(&quot;Amount&quot; AS REAL) amount, &quot;Status&quot;
FROM &quot;Amazon Sale Report&quot;
WHERE &quot;Status&quot; LIKE '%Delivered%'
ORDER BY &quot;Date&quot; DESC
LIMIT 10;


SELECT &quot;Category&quot;,
       SUM(CAST(&quot;Amount&quot; AS REAL)) AS total_revenue,
       AVG(CAST(&quot;Amount&quot; AS REAL)) AS avg_amount,
       COUNT(*) AS lines
FROM &quot;Amazon Sale Report&quot;
GROUP BY &quot;Category&quot;
ORDER BY total_revenue DESC;


SELECT ('20' || SUBSTR(&quot;Date&quot;,7,2) || '-' || SUBSTR(&quot;Date&quot;,1,2)) AS year_month,
       SUM(CAST(&quot;Amount&quot; AS REAL)) AS revenue,
       COUNT(DISTINCT &quot;Order ID&quot;) AS orders
FROM &quot;Amazon Sale Report&quot;
GROUP BY year_month
ORDER BY year_month;


DROP TABLE IF EXISTS products;
CREATE TABLE products AS
SELECT DISTINCT &quot;SKU&quot; AS sku, &quot;Style&quot; AS style, &quot;Category&quot; AS category, &quot;ASIN&quot; AS asin
FROM &quot;Amazon Sale Report&quot;;

DROP TABLE IF EXISTS orders;
CREATE TABLE orders AS
SELECT &quot;Order ID&quot; AS order_id,
       MIN(&quot;Date&quot;) AS order_date,
       MIN(&quot;Status&quot;) AS status,
       MIN(&quot;ship-city&quot;) AS ship_city,
       MIN(&quot;ship-state&quot;) AS ship_state,
       SUM(CAST(&quot;Amount&quot; AS REAL)) AS order_total
FROM &quot;Amazon Sale Report&quot;
GROUP BY &quot;Order ID&quot;;

DROP TABLE IF EXISTS order_items;
CREATE TABLE order_items AS
SELECT &quot;Order ID&quot; AS order_id, &quot;SKU&quot; AS sku, &quot;Category&quot; AS category,
       CAST(&quot;Qty&quot; AS INTEGER) AS quantity,
       CAST(&quot;Amount&quot; AS REAL) AS line_amount
FROM &quot;Amazon Sale Report&quot;;

SELECT oi.order_id, oi.sku, o.order_total
FROM order_items oi
LEFT JOIN orders o ON oi.order_id = o.order_id
ORDER BY oi.order_id
LIMIT 50;


SELECT sku, SUM(line_amount) AS revenue
FROM order_items
GROUP BY sku
HAVING SUM(line_amount) &gt; (
  SELECT AVG(prod_rev) FROM (
    SELECT SUM(line_amount) AS prod_rev
    FROM order_items
    GROUP BY sku
  )
)
ORDER BY revenue DESC;


SELECT sku AS SKU, SUM(line_amount) AS total_revenue, SUM(quantity) AS units_sold
FROM order_items
GROUP BY sku
ORDER BY total_revenue DESC
LIMIT 10;

SELECT o.ship_city, SUM(o.order_total) AS city_revenue, COUNT(o.order_id) AS orders
FROM orders o
GROUP BY o.ship_city
ORDER BY city_revenue DESC
LIMIT 15;


DROP VIEW IF EXISTS vw_order_summary;
CREATE VIEW vw_order_summary AS
SELECT o.order_id, o.order_date, o.ship_city, o.ship_state, o.order_total,
       COUNT(oi.sku) AS items_count,
       GROUP_CONCAT(DISTINCT p.category) AS categories
FROM orders o
LEFT JOIN order_items oi ON o.order_id = oi.order_id
LEFT JOIN products p ON oi.sku = p.sku
GROUP BY o.order_id, o.order_date, o.ship_city, o.ship_state, o.order_total;

SELECT * FROM vw_order_summary
ORDER BY order_total DESC
LIMIT 20;


CREATE INDEX IF NOT EXISTS idx_orders_orderdate ON orders(order_date);
CREATE INDEX IF NOT EXISTS idx_orderitems_sku ON order_items(sku);
CREATE INDEX IF NOT EXISTS idx_orderitems_orderid ON order_items(order_id);
CREATE INDEX IF NOT EXISTS idx_products_category ON products(category);

SELECT o.order_date, SUM(oi.line_amount) AS revenue
FROM orders o
JOIN order_items oi ON o.order_id = oi.order_id
WHERE o.order_date BETWEEN '04-01-22' AND '04-30-22'
GROUP BY o.order_date
ORDER BY o.order_date;

</sql><current_tab id="0"/></tab_sql></sqlb_project>
